#! /usr/bin/env coffee

spawn = require("child_process").spawn

coffee = (args) ->
  child = spawn("coffee", args)
  child.stdout.on "data", (data) ->
    console.log(data.toString())
  child.stderr.on "data", (data) ->
    console.log(data.toString())

task "watch", "Watch/compile changed .coffee files.", (options) ->
  server = coffee(["-r", "/Users/mark/bin/brew.coffee", "-c", "-w", "server"])
  client = coffee(["-r", "/Users/mark/bin/brew.coffee", "-c", "-o", "public/javascripts/client", "-w", "client"])

task "compile", "Compile .coffee files.", (options) ->
  server = coffee(["-r", "/Users/mark/bin/brew.coffee", "-c", "server"])
  client = coffee(["-r", "/Users/mark/bin/brew.coffee", "-c", "-o", "public/javascripts/client", "client"])

task "node", "Run the server.", (options) ->
  invoke("compile")
  spawn("node", ["App.js"])

task "nodemon", "Run and monitor the server.", (options) ->
  invoke("compile")
  spawn("nodemon")
